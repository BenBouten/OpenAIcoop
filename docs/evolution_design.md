# Evolution Simulation Design Overview

## Target Philosophy
- **Emergent behaviour**: minimise hand-authored roles; let pursuit, avoidance and cooperation arise from sensory input, local incentives and physics constraints instead of explicit predator/prey flags.
- **Physics-first movement**: locomotion should flow from hydrodynamic properties (mass, drag, thrust, steering surfaces) and environmental forces (currents, buoyancy) rather than behaviour-mode speed presets.
- **Energy-driven reproduction**: allow lifeforms to reproduce only when energy reserves exceed a configurable surplus and age/maturity thresholds, spending biomass/energy to spawn offspring.
- **Resource-based ecosystem**: plants, carcasses and other biomass pools should be consumed and decomposed into nutrients that circulate through the food web; feeding should change energy, health and possibly toxins.
- **Trait-driven visuals**: render skin pigments, morphology silhouettes and bioluminescent emissions directly from genetic traits and environmental state (depth/light), avoiding hardcoded palettes.
- **Generic biomass/bite mechanics**: damage, harvesting and predation should all run through the same biomass and bite-size rules, letting predators emerge naturally from shape, mouth strength and metabolism.

## Current Implementation (Scan)
- **Behaviour & AI**: Behaviour modes are set by explicit threat/food/partner checks in the central brain step, blending vectors for flee/hunt/search and logging mode changes.【F:evolution/entities/ai.py†L49-L218】 Target detection in `Lifeform.update_targets` classifies enemies and prey via attack/defence comparisons and species IDs, with closest targets promoted into `closest_enemy/closest_prey/closest_partner` fields.【F:evolution/entities/lifeform.py†L560-L820】 Hunger and reproduction decisions rely on thresholds and simple flags such as `_foraging_focus` and `ENERGY_REPRODUCTION_THRESHOLD`.【F:evolution/entities/lifeform.py†L400-L461】 Movement effort scales off behaviour modes (flee, hunt, mate) through preset thrust/frequency multipliers rather than physical demand.【F:evolution/entities/movement.py†L97-L146】
- **Resources / Food**: Plant matter is represented by moss clusters with per-cell nutrition pools (`resource`), regrowth and oxygen deprivation logic.【F:evolution/world/vegetation.py†L1-L122】 Lifeforms also track carcasses as carrion targets during sensing, treating them as another consumable resource.【F:evolution/entities/lifeform.py†L760-L813】
- **Reproduction**: Eligibility checks gate mating on cooldown, adulthood, hunger thresholds and energy ratio; reproduction currently does not appear to deduct energy or mass beyond these checks.【F:evolution/entities/lifeform.py†L436-L461】 Offspring DNA is built by mixing parent traits, applying random mutations and potentially registering new profiles; body graphs may be rebuilt for geometry but resource costs are not charged here.【F:evolution/entities/reproduction.py†L31-L145】
- **Movement & Physics**: `movement.py` integrates AI directions into thrust/steering, applying behaviour-specific thrust/frequency targets and environment biases (depth, buoyancy, hunger) before physics forces are computed.【F:evolution/entities/movement.py†L50-L172】 Physical parameters (mass, drag, buoyancy, thrust, grip) are derived from the modular body graph into a `PhysicsBody` used by movement and combat.【F:evolution/physics/physics_body.py†L7-L66】
- **Brains / AI Architecture**: The AI is a single procedural function (`update_brain`) that handles memory, target selection, group heuristics and escape overrides; there is no learning or pluggable neural model in this path.【F:evolution/entities/ai.py†L49-L218】 Behaviour is largely reactive and rule-based rather than emergent from lower-level drives.
- **Visuals & Bioluminescence**: Creature visuals derive from base colors with pigment adjustments during lifeform construction, while the renderer includes ocean gradients and glow helpers for vents/bioluminescent elements.【F:evolution/entities/lifeform.py†L20-L120】【F:evolution/rendering/ocean_renderer.py†L6-L118】 Module definitions carry a `bioluminescence` trait and the creature creator exposes a biolum slider, but there is no clear path wiring those values into runtime rendering or lighting effects.【F:evolution/body/modules.py†L268-L338】【F:evolution/rendering/creature_creator_overlay.py†L47-L985】

## Gap Analysis vs Target Design
- Behaviour currently hardcodes flee/hunt/mate/search modes and classifies predators/prey globally, conflicting with the emergent-behaviour goal where appetites and physics should drive encounters.【F:evolution/entities/ai.py†L88-L218】【F:evolution/entities/lifeform.py†L560-L820】
- Movement speed/frequency presets per behaviour mode bypass the physical constraints derived from drag, thrust and currents, working against a physics-first approach.【F:evolution/entities/movement.py†L97-L146】
- Reproduction is gated by thresholds but does not consume energy/biomass at spawn time, leaving little incentive for foraging-driven reproduction loops.【F:evolution/entities/lifeform.py†L436-L461】【F:evolution/entities/reproduction.py†L31-L145】
- Resource handling focuses on discrete plants and carcasses without nutrient cycling or toxin/quality modelling, limiting emergent diets beyond simple hunger satisfaction.【F:evolution/world/vegetation.py†L1-L122】【F:evolution/entities/lifeform.py†L760-L813】
- Visual traits like bioluminescence are exposed in blueprints and UI yet are not consistently rendered or tied to environmental cues (depth/light), undermining trait-driven visuals.【F:evolution/body/modules.py†L268-L338】【F:evolution/rendering/creature_creator_overlay.py†L47-L985】【F:evolution/rendering/ocean_renderer.py†L6-L118】
- AI is centralized and behaviour-role-driven, with shared knowledge of closest enemies/prey rather than local sensory inputs feeding simple instincts, which hampers emergent predator identity from generic biomass/bite mechanics.【F:evolution/entities/ai.py†L49-L218】【F:evolution/entities/lifeform.py†L560-L820】

## Key Pain Points
- Hardcoded behaviour modes and role assumptions (enemy vs prey vs partner) prevent behaviours from emerging from metabolism, opportunity and physics alone.【F:evolution/entities/ai.py†L88-L218】【F:evolution/entities/lifeform.py†L560-L820】
- Behaviour-mode thrust/frequency presets decouple locomotion from hydrodynamics, masking differences between body plans and environments.【F:evolution/entities/movement.py†L97-L146】
- Reproduction logic lacks explicit energy/biomass spend, so populations can grow without tangible metabolic cost once thresholds are met.【F:evolution/entities/lifeform.py†L436-L461】【F:evolution/entities/reproduction.py†L31-L145】
- Resource and consumption systems are compartmentalized (plants vs carcass) with no shared biomass accounting or nutrient recycling, making ecosystem feedback shallow.【F:evolution/world/vegetation.py†L1-L122】【F:evolution/entities/lifeform.py†L760-L813】
- Bioluminescent traits exist in data and UI but are not connected to rendering/lighting behaviour, reducing visual signalling and depth-awareness opportunities.【F:evolution/body/modules.py†L268-L338】【F:evolution/rendering/creature_creator_overlay.py†L47-L985】【F:evolution/rendering/ocean_renderer.py†L6-L118】
- AI architecture is monolithic and rule-based with implicit global knowledge, limiting experimentation with learning-driven or modular decision layers aligned to emergent behaviour goals.【F:evolution/entities/ai.py†L49-L218】
